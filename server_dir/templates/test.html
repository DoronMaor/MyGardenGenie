<!DOCTYPE html>
<html>
  <head>
    <title>Server Handler SockIO Demo</title>
    <link
      rel="stylesheet"
      href="{{url_for('static', filename='remotePage.css')}}"
    />
    <script
      src="https://cdn.socket.io/3.1.3/socket.io.min.js"
      integrity="sha384-cPwlPLvBTa3sKAgddT6krw0cJat7egBga3DJepJyrLl4Q9/5WLra3rrnMcyTyOnh"
      crossorigin="anonymous"
    ></script>
    <script src="{{url_for('static', filename='ServerHandler.js')}}"></script>

    <script>
      var server_handler = new ServerHandlerSockIO("127.0.0.1", 5000);
      var current_plant = "A";
      server_handler.login("2", "2");
    </script>
  </head>
  <body>
    <h1>Plant Monitoring</h1>
    <button id="remote-mode">Start Remote Mode</button>
    <button id="video-mode">Start Video Mode</button>
    <button id="switch-plant">Switch Plant</button>
    <input type="text" hidden value="A" />

    <div id="remote-actions" style="display: none">
      <h2>Remote Actions</h2>
      <button id="display-text">display_text</button>
      <button id="get-moisture">get_moisture</button>
      <button id="led-ring">led_ring</button>
      <button id="add-water">add_water</button>
      <button id="get-light-level">get_light_level</button>
      <button id="change-automatic">change_automatic</button>
      <button id="remote-stop">remote_stop</button>
    </div>
    <div id="video-actions" style="display: none">
      <h2>Video Actions</h2>
      <button id="stream-start">stream_start</button>
      <button id="stream-stop">stream_stop</button>
    </div>
     <img id="video" src="#">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(function () {
            var video = $('#video')[0];
            var source = new EventSource('http://127.0.0.1:8080/video');

            source.onmessage = function (event) {
                video.src = "data:image/jpeg;base64," + event.data;
            };
        });
    </script>
  </body>
  <script>
    const remoteModeBtn = document.querySelector("#remote-mode");
    const videoModeBtn = document.querySelector("#video-mode");
    const switchPlantBtn = document.querySelector("#switch-plant");
    const remoteActions = document.querySelector("#remote-actions");
    const videoActions = document.querySelector("#video-actions");

    remoteModeBtn.addEventListener("click", () => {
      if (remoteActions.style.display == "block") {
        remoteModeBtn.textContent = "Start Remote Mode";
        remoteActions.style.display = "none";
        server_handler.stop_remote_mode();
      } else {
        remoteModeBtn.textContent = "Stop Remote Mode";
        remoteActions.style.display = "block";
        server_handler.start_remote_mode();
      }
    });

    videoModeBtn.addEventListener("click", () => {
      if (videoActions.style.display == "block") {
        videoModeBtn.textContent = "Start Video Mode";
        videoActions.style.display = "none";
        server_handler.video_start("127.0.0.1", 8080);
      } else {
        videoModeBtn.textContent = "Stop Video Mode";
        videoActions.style.display = "block";
        server_handler.stop_receiving("127.0.0.1", 8080);
      }
    });

    document.getElementById("get-moisture").addEventListener("click", () => {
      server_handler.get_moisture(current_plant);
    });

    document.getElementById("display-text").addEventListener("click", () => {
      server_handler.set_text("text");
    });

    document.getElementById("led-ring").addEventListener("click", () => {
      server_handler.led_ring(current_plant, true);
    });

    document.getElementById("add-water").addEventListener("click", () => {
      server_handler.add_water(current_plant, 4);
    });

    document.getElementById("get-light-level").addEventListener("click", () => {
      server_handler.get_light_level(current_plant);
    });

    document
      .getElementById("change-automatic")
      .addEventListener("click", () => {
        server_handler.change_automatic(current_plant, "1");
      });

    document.getElementById("remote-stop").addEventListener("click", () => {
      server_handler.stop_remote_mode();
    });
  </script>
</html>
